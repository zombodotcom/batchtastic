<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batchtastic Pro | Meshtastic Batch Flasher</title>
    <link rel="stylesheet" href="./src/style.css">
</head>
<body>

<!-- Top Action Bar -->
<header class="top-action-bar">
    <div class="action-bar-content">
        <h1 class="app-title">Batchtastic Pro</h1>
        <div class="action-buttons">
            <button class="btn btn-primary" id="addDeviceBtn" onclick="openBoardSelector()">
                ‚ûï Add Device
            </button>
            <button class="btn btn-secondary" id="configureAllBtn" onclick="openConfigPanel()" disabled>
                ‚öôÔ∏è Configure All
            </button>
            <button class="btn btn-success" id="flashAllBtn" onclick="flashAllDevices()" disabled>
                üöÄ Flash All
            </button>
            <div class="device-count-badge" id="deviceCountBadge">0 devices</div>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="main-content">
    <!-- Device Grid -->
    <div id="deviceGrid" class="device-grid">
        <div class="empty-state" id="emptyState">
            <div class="empty-icon">üì°</div>
            <h2>No devices added yet</h2>
            <p>Click "Add Device" to start batch programming</p>
        </div>
    </div>
</main>

<!-- Board Selector Modal -->
<div id="boardSelectorModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Select Board Type</h2>
            <button class="modal-close" onclick="closeBoardSelector()">‚úï</button>
        </div>
        <div class="modal-body">
            <!-- Vendor Filters -->
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all" onclick="filterBoards('all')">All</button>
                <button class="filter-btn" data-filter="lilygo" onclick="filterBoards('lilygo')">LilyGO</button>
                <button class="filter-btn" data-filter="heltec" onclick="filterBoards('heltec')">Heltec</button>
                <button class="filter-btn" data-filter="rak" onclick="filterBoards('rak')">RAK</button>
                <button class="filter-btn" data-filter="seeed" onclick="filterBoards('seeed')">Seeed</button>
            </div>
            <!-- Chip Type Filters -->
            <div class="filter-buttons" style="margin-top: 0.5rem;">
                <button class="filter-btn" data-chip="all" onclick="filterChips('all')">All Chips</button>
                <button class="filter-btn" data-chip="esp32" onclick="filterChips('esp32')">ESP32</button>
                <button class="filter-btn" data-chip="esp32-s3" onclick="filterChips('esp32-s3')">ESP32-S3</button>
                <button class="filter-btn" data-chip="nrf52840" onclick="filterChips('nrf52840')">nRF52840</button>
                <button class="filter-btn" data-chip="rp2040" onclick="filterChips('rp2040')">RP2040</button>
            </div>
            <!-- Board Grid -->
            <div id="boardGrid" class="board-grid">
                <!-- Boards will be rendered here -->
            </div>
        </div>
    </div>
</div>

<!-- Configuration Panel Modal -->
<div id="configPanelModal" class="modal-overlay" style="display: none;">
    <div class="modal-content config-panel">
        <div class="modal-header">
            <h2>Configure All Devices</h2>
            <button class="modal-close" onclick="closeConfigPanel()">‚úï</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Deployment Region</label>
                <select id="region">
                    <option value="US">United States (915MHz)</option>
                    <option value="EU_868">Europe (868MHz)</option>
                    <option value="EU_433">Europe (433MHz)</option>
                    <option value="CN">China (470MHz)</option>
                    <option value="JP">Japan (920MHz)</option>
                    <option value="ANZ">Australia/New Zealand</option>
                    <option value="KR">South Korea</option>
                    <option value="TW">Taiwan</option>
                    <option value="RU">Russia</option>
                    <option value="IN">India</option>
                    <option value="NZ_865">New Zealand (865MHz)</option>
                    <option value="TH">Thailand</option>
                    <option value="LORA_24">LoRa 2.4GHz</option>
                    <option value="UA_433">Ukraine (433MHz)</option>
                    <option value="UA_868">Ukraine (868MHz)</option>
                    <option value="MY_433">Malaysia (433MHz)</option>
                    <option value="MY_919">Malaysia (919MHz)</option>
                    <option value="SG_923">Singapore (923MHz)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Modem Preset</label>
                <select id="modemPreset">
                    <option value="">Default (use channel name)</option>
                    <option value="LONG_FAST">Long Fast</option>
                    <option value="LONG_SLOW">Long Slow</option>
                    <option value="LONG_MODERATE">Long Moderate</option>
                    <option value="MEDIUM_FAST">Medium Fast</option>
                    <option value="MEDIUM_SLOW">Medium Slow</option>
                    <option value="SHORT_FAST">Short Fast</option>
                    <option value="SHORT_SLOW">Short Slow</option>
                    <option value="VERY_LONG_SLOW">Very Long Slow</option>
                </select>
            </div>
            <div class="form-group">
                <label>Primary Channel</label>
                <input type="text" id="channelName" value="LongFast" placeholder="e.g., LongFast, MediumFast">
            </div>
            <div class="form-group">
                <label>Node Role</label>
                <select id="nodeRole">
                    <option value="ROUTER">Router</option>
                    <option value="CLIENT">Client</option>
                    <option value="CLIENT_MUTE">Client Mute</option>
                    <option value="TRACKER">Tracker</option>
                    <option value="SENSOR">Sensor</option>
                    <option value="TAK">TAK</option>
                    <option value="CLIENT_HIDDEN">Client Hidden</option>
                    <option value="LOST_AND_FOUND">Lost and Found</option>
                    <option value="TAK_TRACKER">TAK Tracker</option>
                    <option value="ROUTER_LATE">Router Late</option>
                    <option value="CLIENT_BASE">Client Base</option>
                </select>
            </div>
            <div class="form-group">
                <label>TX Power (dBm)</label>
                <input type="number" id="txPower" min="0" max="30" placeholder="Auto (leave empty)">
            </div>
            <div class="form-group">
                <label>Hop Limit</label>
                <input type="number" id="hopLimit" min="1" max="7" placeholder="Auto (leave empty)">
            </div>
            <button class="btn btn-primary" onclick="applyConfigToAll()" style="width: 100%; margin-top: 1rem;">
                ‚úÖ Apply Configuration to All Devices
            </button>
        </div>
    </div>
</div>

<!-- Firmware Selection Panel (Hidden, accessed via settings) -->
<div id="firmwarePanel" style="display: none;">
    <div class="card">
        <h2>üìÇ Firmware & Platform</h2>
        <div class="form-group">
            <label>Release Channel</label>
            <select id="releaseChannel">
                <option value="stable">Stable</option>
                <option value="alpha">Alpha</option>
            </select>
        </div>
        <div class="form-group">
            <label>Firmware Version</label>
            <select id="firmwareType">
                <option value="custom">Custom .bin Files</option>
            </select>
        </div>
        <div class="form-group">
            <label>Target Platform</label>
            <select id="targetPlatform">
                <option value="tbeam" selected>T-Beam</option>
                <option value="tbeam-s3-core">T-Beam S3</option>
                <option value="tlora-v2">T-LoRa V2</option>
                <option value="heltec-v3">Heltec V3</option>
                <option value="rak4631">RAK4631</option>
                <option value="t-deck">T-Deck</option>
            </select>
        </div>
        <label style="display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0; font-size: 0.85rem;">
            <input type="checkbox" id="fullInstall">
            <span style="color: var(--error);">Full Install (Erase All)</span>
        </label>
        <input type="file" id="customFile" accept=".bin,.zip" multiple style="margin-top: 0.5rem; display: none;">
        <div id="firmwareList" style="font-size: 0.7rem; color: var(--text-dim); margin-top: 0.5rem;"></div>
    </div>
</div>

<script type="module" src="./src/main.js"></script>

</body>
</html>
