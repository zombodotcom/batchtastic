<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batchtastic Pro | Meshtastic Deployment HUD</title>
    <link rel="stylesheet" href="./src/style.css">
</head>
<body>

<div class="hud-container">
    <aside class="controls">
        <div class="card">
            <h2>‚ö° Batch Operations</h2>
            <div id="batchStatus" class="batch-status">
                <span class="batch-status-indicator"></span>
                <span id="batchStatusText">No devices connected</span>
            </div>
            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                <button class="btn btn-primary" style="flex:1" onclick="manager.addDeviceUSB().then(render).catch(e => alert(e.message))">üîå Add USB</button>
                <button class="btn btn-primary" style="flex:1" onclick="manager.addDeviceBLE().then(render).catch(e => alert(e.message))">üì∂ Add BLE</button>
            </div>
            <button class="btn btn-secondary" style="margin-bottom: 0.5rem;" onclick="const nodeId = prompt('Enter Meshtastic Node ID (or leave blank):'); manager.addDeviceOTA(nodeId || null).then(render).catch(e => alert(e.message))">üì° Add OTA Target</button>
            <div style="border-top: 1px solid #334155; margin: 0.75rem 0; padding-top: 0.75rem;">
                <button class="btn btn-success" id="flashAllBtn" onclick="manager.flashAll()" disabled style="width: 100%; font-size: 1rem; padding: 0.875rem;">üöÄ Flash All Selected</button>
                <button class="btn btn-success" id="otaBtn" onclick="manager.flashAllOTA().catch(e => alert(e.message))" disabled style="margin-top: 0.5rem; width: 100%;">üåê OTA Update All</button>
            </div>
        </div>

        <div class="card">
            <h2>üìã Device Templates</h2>
            <div class="form-group">
                <label>Template Name</label>
                <input type="text" id="templateName" placeholder="e.g., Router-01, Field-Node-A">
            </div>
            <div class="form-group">
                <label>Device Name</label>
                <input type="text" id="templateDeviceName" placeholder="Name for this device (optional)">
            </div>
            <button class="btn btn-secondary" style="margin-top: 0.5rem;" onclick="saveCurrentAsTemplate()">üíæ Save Current Settings as Template</button>
            <div id="templateList" style="margin-top: 1rem; max-height: 200px; overflow-y: auto;">
                <!-- Templates will be rendered here -->
            </div>
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #334155;">
                <div class="form-group">
                    <label>Pending Devices (Pre-configured)</label>
                    <div id="pendingDevices" style="font-size: 0.85rem;">
                        <!-- Pending devices will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üíæ Mission Profile</h2>
            <div class="form-group">
                <label>Deployment Region</label>
                <select id="region">
                    <option value="US">United States (915MHz)</option>
                    <option value="EU_868">Europe (868MHz)</option>
                    <option value="EU_433">Europe (433MHz)</option>
                    <option value="CN">China (470MHz)</option>
                    <option value="JP">Japan (920MHz)</option>
                    <option value="ANZ">Australia/New Zealand</option>
                    <option value="KR">South Korea</option>
                    <option value="TW">Taiwan</option>
                    <option value="RU">Russia</option>
                    <option value="IN">India</option>
                    <option value="NZ_865">New Zealand (865MHz)</option>
                    <option value="TH">Thailand</option>
                    <option value="LORA_24">LoRa 2.4GHz</option>
                    <option value="UA_433">Ukraine (433MHz)</option>
                    <option value="UA_868">Ukraine (868MHz)</option>
                    <option value="MY_433">Malaysia (433MHz)</option>
                    <option value="MY_919">Malaysia (919MHz)</option>
                    <option value="SG_923">Singapore (923MHz)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Modem Preset</label>
                <select id="modemPreset">
                    <option value="">Default (use channel name)</option>
                    <option value="LONG_FAST">Long Fast</option>
                    <option value="LONG_SLOW">Long Slow</option>
                    <option value="LONG_MODERATE">Long Moderate</option>
                    <option value="MEDIUM_FAST">Medium Fast</option>
                    <option value="MEDIUM_SLOW">Medium Slow</option>
                    <option value="SHORT_FAST">Short Fast</option>
                    <option value="SHORT_SLOW">Short Slow</option>
                    <option value="VERY_LONG_SLOW">Very Long Slow</option>
                </select>
            </div>
            <div class="form-group">
                <label>Primary Channel</label>
                <input type="text" id="channelName" value="LongFast" placeholder="e.g., LongFast, MediumFast">
            </div>
            <div class="form-group">
                <label>Node Role</label>
                <select id="nodeRole">
                    <option value="ROUTER">Router</option>
                    <option value="CLIENT">Client</option>
                    <option value="CLIENT_MUTE">Client Mute</option>
                    <option value="TRACKER">Tracker</option>
                    <option value="SENSOR">Sensor</option>
                    <option value="TAK">TAK</option>
                    <option value="CLIENT_HIDDEN">Client Hidden</option>
                    <option value="LOST_AND_FOUND">Lost and Found</option>
                    <option value="TAK_TRACKER">TAK Tracker</option>
                    <option value="ROUTER_LATE">Router Late</option>
                    <option value="CLIENT_BASE">Client Base</option>
                </select>
            </div>
            <div class="form-group">
                <label>TX Power (dBm)</label>
                <input type="number" id="txPower" min="0" max="30" placeholder="Auto (leave empty)">
            </div>
            <div class="form-group">
                <label>Hop Limit</label>
                <input type="number" id="hopLimit" min="1" max="7" placeholder="Auto (leave empty)">
            </div>
            <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="manager.selectAll(); render();">‚úì Select All</button>
                <button class="btn btn-secondary" style="flex: 1;" onclick="manager.deselectAll(); render();">‚úó Deselect All</button>
            </div>
            <button class="btn btn-primary" style="margin-top: 0.5rem; width: 100%;" onclick="applyMissionProfile()" id="applyProfileBtn">‚öôÔ∏è Apply to All Devices</button>
        </div>

        <div class="card">
            <h2>üìÇ Firmware & Platform</h2>
            <div class="form-group">
                <label>Release Channel</label>
                <select id="releaseChannel">
                    <option value="stable">Stable</option>
                    <option value="alpha">Alpha</option>
                </select>
            </div>
            <div class="form-group">
                <label>Firmware Version</label>
                <select id="firmwareType">
                    <option value="custom">Custom .bin Files</option>
                </select>
            </div>
            <div class="form-group">
                <label>Select Target Platform</label>
                <div id="platformGrid" class="platform-grid">
                    <div class="platform-card" data-platform="tbeam" onclick="selectPlatform('tbeam')">
                        <div class="platform-icon">üì°</div>
                        <div class="platform-name">T-Beam</div>
                        <div class="platform-vendor">LilyGO</div>
                    </div>
                    <div class="platform-card" data-platform="tbeam-s3-core" onclick="selectPlatform('tbeam-s3-core')">
                        <div class="platform-icon">üì°</div>
                        <div class="platform-name">T-Beam S3</div>
                        <div class="platform-vendor">LilyGO</div>
                    </div>
                    <div class="platform-card" data-platform="tlora-v2" onclick="selectPlatform('tlora-v2')">
                        <div class="platform-icon">üìª</div>
                        <div class="platform-name">T-LoRa V2</div>
                        <div class="platform-vendor">LilyGO</div>
                    </div>
                    <div class="platform-card" data-platform="heltec-v3" onclick="selectPlatform('heltec-v3')">
                        <div class="platform-icon">üì°</div>
                        <div class="platform-name">Heltec V3</div>
                        <div class="platform-vendor">Heltec</div>
                    </div>
                    <div class="platform-card" data-platform="rak4631" onclick="selectPlatform('rak4631')">
                        <div class="platform-icon">üì°</div>
                        <div class="platform-name">RAK4631</div>
                        <div class="platform-vendor">RAK</div>
                    </div>
                    <div class="platform-card" data-platform="t-deck" onclick="selectPlatform('t-deck')">
                        <div class="platform-icon">‚å®Ô∏è</div>
                        <div class="platform-name">T-Deck</div>
                        <div class="platform-vendor">LilyGO</div>
                    </div>
                </div>
                <input type="hidden" id="targetPlatform" value="tbeam">
            </div>
            <label style="display: flex; align-items: center; gap: 0.5rem; margin: 0.5rem 0; font-size: 0.85rem;">
                <input type="checkbox" id="fullInstall">
                <span style="color: var(--error);">Full Install (Erase All)</span>
            </label>
            <input type="file" id="customFile" accept=".bin,.zip" multiple style="margin-top: 0.5rem; display: none;">
            <div id="firmwareList" style="font-size: 0.7rem; color: var(--text-dim); margin-top: 0.5rem;"></div>
        </div>
    </aside>

    <main class="dashboard">
        <div class="card" style="display:flex; justify-content: space-between; align-items: center;">
            <h1 style="font-size: 1.25rem;">Batchtastic Pro Hub</h1>
            <div id="batchStats" style="font-size: 0.8rem; color: var(--text-dim);">
                0 Nodes Connected | Idle
            </div>
        </div>

        <div id="deviceGrid" class="device-grid"></div>
        
        <!-- Packet Rain Visualization -->
        <div style="position: relative; margin-top: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                <h3 style="margin: 0; font-size: 0.9rem;">üì° Mesh Activity</h3>
                <button id="packetRainToggle" class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Toggle</button>
            </div>
            <canvas id="packetRainCanvas" style="width: 100%; height: 200px; background: var(--bg-secondary); border-radius: 4px; display: block;"></canvas>
        </div>

        <div class="card">
            <h2>üìú Global Batch Log</h2>
            <div id="globalLog" class="log-container" style="height: 150px;">
                <div style="color: var(--accent)">[SYSTEM] Ready for batch operation.</div>
            </div>
        </div>
    </main>
</div>

<script type="module" src="./src/main.js"></script>

</body>
</html>
